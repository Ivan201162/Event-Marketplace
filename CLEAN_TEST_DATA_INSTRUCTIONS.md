# Инструкция по очистке тестовых данных

## Требования

Для выполнения скрипта очистки необходимо:

1. **Firebase Service Account ключ**
   - Скачайте ключ из Firebase Console: Project Settings → Service Accounts → Generate New Private Key
   - Сохраните файл как `firebase-service-account.json` в корне проекта
   - ИЛИ установите переменную окружения `GOOGLE_APPLICATION_CREDENTIALS` с путём к файлу

2. **Node.js и зависимости**
   ```bash
   cd tools
   npm install
   ```

## Запуск

```bash
cd tools
npx ts-node clean_test_data.ts
```

## Что делает скрипт

1. **Определяет тестовых пользователей** по критериям:
   - email содержит: test, demo, example, fake, dev, seed
   - username содержит: test, demo, mock, autogen
   - displayName содержит: Test, Demo, User123, Generated
   - uid начинается с: test_, seed_, mock_
   - старые неактивные аккаунты (старше 10 дней, без постов/подписчиков)

2. **Удаляет связанные данные**:
   - Все документы, где `authorId`/`userId` относится к тестовому пользователю
   - Чаты и сообщения, где участвует тестовый пользователь
   - Файлы в Storage, принадлежащие тестовым пользователям

3. **НЕ удаляет**:
   - Аккаунты с реальными email (gmail.com, yandex.ru и т.п.)
   - Пользователей с активностью (>0 постов/подписчиков/чатов)
   - Документы с `production: true`

## Отчёт

После завершения скрипт выведет:
- Количество удалённых документов по каждой коллекции
- Количество удалённых файлов из Storage
- Список коллекций после очистки
- Подтверждение, что реальные данные не затронуты

