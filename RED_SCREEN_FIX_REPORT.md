# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫—Ä–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞

## ‚úÖ –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê –ü–û–õ–ù–û–°–¢–¨–Æ!

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã:

#### üîç –ü—Ä–∏—á–∏–Ω–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞:
**–û—à–∏–±–∫–∞**: `ref.listen can only be used within the build method of a ConsumerWidget`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `lib/screens/auth_screen.dart`, —Å—Ç—Ä–æ–∫–∞ 40, –º–µ—Ç–æ–¥ `initState`

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í –º–µ—Ç–æ–¥–µ `initState` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `ref.listen`, —á—Ç–æ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ –≤ Riverpod. –ú–µ—Ç–æ–¥ `ref.listen` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ `build` –≤–∏–¥–∂–µ—Ç–∞.

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

#### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ ref.listen
**–§–∞–π–ª**: `lib/screens/auth_screen.dart`

**–ë—ã–ª–æ**:
```dart
@override
void initState() {
  super.initState();
  
  // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  ref.listen(authStateProvider, (previous, next) {
    next.whenData((isAuthenticated) {
      if (isAuthenticated && mounted) {
        context.go('/home');
      }
    });
  });
}
```

**–°—Ç–∞–ª–æ**:
```dart
@override
void initState() {
  super.initState();
}

@override
Widget build(BuildContext context) {
  final loginState = ref.watch(loginFormNotifierProvider);
  final authState = ref.watch(authStateProvider);

  // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  ref.listen(authStateProvider, (previous, next) {
    next.whenData((isAuthenticated) {
      if (isAuthenticated && mounted) {
        context.go('/home');
      }
    });
  });

  return Scaffold(
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  );
}
```

### –ü—Ä–æ—Ü–µ—Å—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

#### 1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ç–æ—á–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
- –ù–∞–π–¥–µ–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ

#### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
- –£–¥–∞–ª–µ–Ω `ref.listen` –∏–∑ `initState`
- –ü–µ—Ä–µ–º–µ—â–µ–Ω `ref.listen` –≤ –º–µ—Ç–æ–¥ `build`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

#### 3. ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
- `flutter clean` - –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `flutter pub get` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- `flutter build apk --debug --no-tree-shake-icons` - —Å–±–æ—Ä–∫–∞ APK

#### 4. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `adb install -r build\app\outputs\flutter-apk\app-debug.apk` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- `adb shell am start -n com.eventmarketplace.app/com.eventmarketplace.app.MainActivity` - –∑–∞–ø—É—Å–∫

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

#### ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é —Ä–∞–±–æ—Ç—É:
```
INFO: [mock_auth_service] –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å email: testuser@example.com
INFO: [mock_auth_service] –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ —Å email
INFO: [mock_auth_service] –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –∫–∞–∫ –≥–æ—Å—Ç—å
INFO: [mock_auth_service] –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –∫–∞–∫ –≥–æ—Å—Ç—å
INFO: [mock_auth_service] –û—Ç–ø—Ä–∞–≤–∫–∞ SMS –Ω–∞ –Ω–æ–º–µ—Ä: +79998887766
INFO: [mock_auth_service] SMS –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
```

#### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **Email/Password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **Guest –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç  
- **PhoneAuth**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **MockAuthService**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:
- **–¢–∏–ø**: Riverpod lifecycle error
- **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ref.listen`
- **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π lifecycle –º–µ—Ç–æ–¥

#### –°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏:
- **APK**: ‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞**: ‚úÖ –£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- **–ó–∞–ø—É—Å–∫**: ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**üéâ –ö–†–ê–°–ù–´–ô –≠–ö–†–ê–ù –£–°–ü–ï–®–ù–û –ò–°–ü–†–ê–í–õ–ï–ù!**

### –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:
- ‚úÖ **–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**: `ref.listen` –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ
- ‚úÖ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ù–µ—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
- ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω**: –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ**: –õ–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

---

**–î–∞—Ç–∞**: 04.10.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö—Ä–∞—Å–Ω—ã–π —ç–∫—Ä–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω  
**–û—à–∏–±–∫–∞**: Riverpod lifecycle error  
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ ref.listen –≤ build –º–µ—Ç–æ–¥  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

















