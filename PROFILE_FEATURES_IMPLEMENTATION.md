# Реализация функций профиля и настроек

## Обзор

Реализован полный функционал профиля пользователя с расширенными настройками, включающий:

- ✅ Редактирование профиля
- ✅ Безопасность и 2FA
- ✅ Настройки внешнего вида
- ✅ Система уведомлений
- ✅ Конфиденциальность
- ✅ PRO-аккаунты с монетизацией
- ✅ Система блокировок
- ✅ Обратная связь

## Структура проекта

### Модели данных

#### `lib/models/user_profile_enhanced.dart`
Расширенная модель профиля пользователя с дополнительными полями:

- **Основная информация**: имя, фамилия, username, биография, город, телефон, сайт
- **Медиа**: аватарка, обложка, видео-презентация (до 30 сек)
- **Социальные ссылки**: Instagram, Telegram, VK, YouTube и др.
- **Настройки видимости**: кто может видеть профиль и информацию
- **Конфиденциальность**: кто может писать, комментировать, упоминать
- **Уведомления**: настройки push, email, тихие часы
- **Внешний вид**: темы, шрифты, анимации
- **Безопасность**: 2FA, сессии, история входов

#### `lib/models/feedback_ticket.dart`
Модель системы обратной связи:

- **Тикеты**: категории (ошибка, предложение, жалоба, платеж)
- **Статусы**: открыт, в работе, решен, закрыт
- **Сообщения**: переписка с поддержкой
- **Приоритеты**: низкий, средний, высокий, срочный

### Сервисы

#### `lib/services/user_profile_service.dart`
Сервис для работы с расширенным профилем:

- Создание и обновление профиля
- Загрузка медиа (аватарка, обложка, видео)
- Управление социальными ссылками
- Настройки видимости и конфиденциальности
- Переключение PRO-аккаунта
- Предпросмотр профиля

#### `lib/services/feedback_service.dart`
Сервис обратной связи:

- Создание и управление тикетами
- Добавление сообщений
- Изменение статусов и приоритетов
- Поиск и статистика

### Экраны

#### Редактирование профиля
- **`lib/screens/profile/edit_profile_screen.dart`**
  - Редактирование основной информации
  - Загрузка аватарки и обложки
  - Видео-презентация (сжатие до 30 сек)
  - Социальные ссылки
  - Настройки видимости
  - Предпросмотр профиля

#### Настройки безопасности
- **`lib/screens/settings/security_settings_screen.dart`**
  - Смена пароля
  - Настройка 2FA (SMS, Email, Authenticator)
  - Управление сессиями
  - История входов
  - Смена email и телефона
  - Привязка/отвязка Google
  - Удаление аккаунта

#### Настройки внешнего вида
- **`lib/screens/settings/appearance_settings_screen.dart`**
  - Выбор темы (светлая/тёмная/системная)
  - Размер шрифта
  - Позиция вкладок
  - Анимации
  - Кастомный фон
  - Предпросмотр темы

#### Настройки уведомлений
- **`lib/screens/settings/notifications_settings_screen.dart`**
  - Типы уведомлений (лайки, комментарии, сообщения)
  - Push и email уведомления
  - Тихие часы
  - Звуки уведомлений

#### Конфиденциальность
- **`lib/screens/settings/privacy_settings_screen.dart`**
  - Кто может писать сообщения
  - Кто может комментировать
  - Кто может упоминать
  - Скрытие от поиска
  - Настройки историй

#### PRO-аккаунт
- **`lib/screens/profile/pro_account_screen.dart`**
  - Активация/деактивация PRO
  - Специализация и портфолио
  - Настройка цен
  - Аналитика профиля
  - Продвижение и VIP-статус
  - Монетизация контента

#### Блокировки
- **`lib/screens/settings/blocked_users_screen.dart`**
  - Список заблокированных пользователей
  - Разблокировка
  - Поиск и блокировка новых пользователей

#### Обратная связь
- **`lib/screens/settings/feedback_screen.dart`**
  - Создание тикетов
  - История обращений
  - Категории (ошибка, предложение, жалоба, платеж)
  - Прикрепление файлов

### Виджеты

#### Профиль
- **`lib/widgets/profile/profile_image_picker.dart`** - Выбор изображений
- **`lib/widgets/profile/social_links_editor.dart`** - Редактор социальных ссылок
- **`lib/widgets/profile/visibility_settings_widget.dart`** - Настройки видимости

#### Безопасность
- **`lib/widgets/security/two_factor_setup_widget.dart`** - Настройка 2FA
- **`lib/widgets/security/sessions_list_widget.dart`** - Управление сессиями
- **`lib/widgets/security/login_history_widget.dart`** - История входов

#### Внешний вид
- **`lib/widgets/appearance/theme_preview_widget.dart`** - Предпросмотр темы

#### PRO-функции
- **`lib/widgets/pro/analytics_widget.dart`** - Аналитика профиля
- **`lib/widgets/pro/promotion_widget.dart`** - Продвижение
- **`lib/widgets/pro/monetization_widget.dart`** - Монетизация

#### Общие
- **`lib/widgets/common/custom_app_bar.dart`** - Кастомная панель
- **`lib/widgets/common/loading_overlay.dart`** - Индикатор загрузки

## Ключевые особенности

### 1. Редактирование профиля
- Полная информация: имя, фамилия, username, биография
- Медиа: аватарка, обложка, видео-презентация
- Социальные ссылки с иконками платформ
- Настройки видимости полей
- Предпросмотр профиля
- Автосохранение изменений

### 2. Безопасность
- Смена пароля с подтверждением
- 2FA через SMS, Email, Authenticator
- Управление активными сессиями
- История входов с геолокацией
- Смена email и телефона
- Привязка/отвязка Google
- Безопасное удаление аккаунта

### 3. Внешний вид
- Три темы: светлая, тёмная, системная
- Четыре размера шрифта
- Позиция вкладок (внизу/сбоку)
- Включение/выключение анимаций
- Кастомный фон профиля
- Предпросмотр изменений

### 4. Уведомления
- Гибкие настройки по типам
- Push и email уведомления
- Тихие часы с настройкой времени
- Звуки уведомлений
- FCM интеграция

### 5. Конфиденциальность
- Уровни доступа для сообщений
- Настройки комментариев и упоминаний
- Скрытие от поиска
- Управление историями
- Режим "близкие друзья"

### 6. PRO-аккаунты
- Специализация и портфолио
- Настройка цен и услуг
- Детальная аналитика
- Платное продвижение
- VIP-статус
- Монетизация контента

### 7. Блокировки
- Список заблокированных
- Разблокировка пользователей
- Поиск для блокировки
- Скрытие контента

### 8. Обратная связь
- Создание тикетов
- Категории обращений
- Прикрепление файлов
- История обращений
- Статусы обработки

## Технические решения

### Архитектура
- Модульная структура с разделением ответственности
- Сервисный слой для бизнес-логики
- Виджеты для переиспользования
- Типизированные модели данных

### Firebase интеграция
- Firestore для хранения данных
- Firebase Storage для медиа
- Firebase Auth для аутентификации
- FCM для уведомлений

### Производительность
- Ленивая загрузка экранов
- Кэширование изображений
- Оптимизация запросов
- Сжатие видео

### Безопасность
- Валидация данных
- Шифрование чувствительной информации
- Защита от CSRF
- Аудит действий

## Использование

### Навигация
```dart
// Переход к редактированию профиля
Navigator.pushNamed(context, '/edit-profile');

// Переход к настройкам безопасности
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => SecuritySettingsScreen(),
  ),
);
```

### Работа с профилем
```dart
final userProfileService = UserProfileService();

// Получить профиль
final profile = await userProfileService.getCurrentUserProfile();

// Обновить информацию
await userProfileService.updateBasicInfo(
  userId: userId,
  firstName: 'Иван',
  lastName: 'Петров',
  bio: 'Описание профиля',
);

// Загрузить аватарку
final avatarUrl = await userProfileService.uploadAvatar(userId, imageFile);
```

### Создание тикета
```dart
final feedbackService = FeedbackService();

final ticket = FeedbackTicket(
  id: DateTime.now().millisecondsSinceEpoch.toString(),
  title: 'Проблема с приложением',
  description: 'Подробное описание',
  category: TicketCategory.bug,
  status: TicketStatus.open,
  createdAt: DateTime.now(),
  updatedAt: DateTime.now(),
);

await feedbackService.createTicket(ticket);
```

## Заключение

Реализован полный функционал профиля пользователя с расширенными настройками, включающий все запрошенные модули:

- ✅ Редактирование профиля с медиа
- ✅ Безопасность с 2FA
- ✅ Настройки внешнего вида
- ✅ Система уведомлений
- ✅ Конфиденциальность
- ✅ PRO-аккаунты с монетизацией
- ✅ Блокировки пользователей
- ✅ Обратная связь

Все модули интегрированы, протестированы и готовы к использованию. Код оптимизирован, следует лучшим практикам Flutter и Firebase.
