# üìß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ email —Å–µ—Ä–≤–∏—Å–∞

## üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
**3 –æ–∫—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞**

## üéØ –¶–µ–ª—å
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å email —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Event Marketplace App.

## üìß –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ email –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### 1. üìÆ Gmail SMTP
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: 
  - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π
  - –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
  - –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å

### 2. üì® SendGrid
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
  - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å
  - –û—Ç–ª–∏—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  - –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å
  - API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 3. üì¨ Mailgun
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
  - –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  - –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  - API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### 4. üì≠ Amazon SES
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–ª—è AWS –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AWS
  - –ù–∏–∑–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
  - –í—ã—Å–æ–∫–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SendGrid

### 1. üîë –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ SendGrid

#### 1.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ https://sendgrid.com
# –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
```

#### 1.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```yaml
# pubspec.yaml
dependencies:
  http: ^1.1.0
  mailer: ^6.0.1
```

#### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```dart
// lib/config/email_config.dart
class EmailConfig {
  static const String sendGridApiKey = 'your_sendgrid_api_key';
  static const String fromEmail = 'noreply@your-domain.com';
  static const String fromName = 'Event Marketplace';
  
  // –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  static const String testFromEmail = 'test@your-domain.com';
  static const String testFromName = 'Event Marketplace Test';
  
  static String get currentFromEmail {
    return kDebugMode ? testFromEmail : fromEmail;
  }
  
  static String get currentFromName {
    return kDebugMode ? testFromName : fromName;
  }
}
```

### 2. üìß –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ email

#### 2.1 SendGrid —Å–µ—Ä–≤–∏—Å
```dart
// lib/services/sendgrid_email_service.dart
import 'package:http/http.dart' as http;
import 'dart:convert';
import '../config/email_config.dart';

class SendGridEmailService {
  static const String _baseUrl = 'https://api.sendgrid.com/v3';
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å email
  Future<bool> sendEmail({
    required String to,
    required String subject,
    required String htmlContent,
    String? textContent,
    List<String>? cc,
    List<String>? bcc,
    Map<String, dynamic>? customArgs,
  }) async {
    final response = await http.post(
      Uri.parse('$_baseUrl/mail/send'),
      headers: {
        'Authorization': 'Bearer ${EmailConfig.sendGridApiKey}',
        'Content-Type': 'application/json',
      },
      body: jsonEncode({
        'personalizations': [
          {
            'to': [{'email': to}],
            if (cc != null) 'cc': cc.map((email) => {'email': email}).toList(),
            if (bcc != null) 'bcc': bcc.map((email) => {'email': email}).toList(),
            if (customArgs != null) 'custom_args': customArgs,
          }
        ],
        'from': {
          'email': EmailConfig.currentFromEmail,
          'name': EmailConfig.currentFromName,
        },
        'subject': subject,
        'content': [
          if (textContent != null)
            {
              'type': 'text/plain',
              'value': textContent,
            },
          {
            'type': 'text/html',
            'value': htmlContent,
          },
        ],
      }),
    );
    
    return response.statusCode == 202;
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–π email
  Future<bool> sendTemplateEmail({
    required String to,
    required String templateId,
    required Map<String, dynamic> dynamicTemplateData,
    List<String>? cc,
    List<String>? bcc,
  }) async {
    final response = await http.post(
      Uri.parse('$_baseUrl/mail/send'),
      headers: {
        'Authorization': 'Bearer ${EmailConfig.sendGridApiKey}',
        'Content-Type': 'application/json',
      },
      body: jsonEncode({
        'personalizations': [
          {
            'to': [{'email': to}],
            if (cc != null) 'cc': cc.map((email) => {'email': email}).toList(),
            if (bcc != null) 'bcc': bcc.map((email) => {'email': email}).toList(),
            'dynamic_template_data': dynamicTemplateData,
          }
        ],
        'from': {
          'email': EmailConfig.currentFromEmail,
          'name': EmailConfig.currentFromName,
        },
        'template_id': templateId,
      }),
    );
    
    return response.statusCode == 202;
  }
}
```

#### 2.2 –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π email —Å–µ—Ä–≤–∏—Å
```dart
// lib/services/email_service.dart
import 'sendgrid_email_service.dart';
import 'smtp_email_service.dart';

class EmailService {
  final SendGridEmailService _sendGridService = SendGridEmailService();
  final SMTPEmailService _smtpService = SMTPEmailService();
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å email
  Future<bool> sendEmail({
    required String to,
    required String subject,
    required String htmlContent,
    String? textContent,
    List<String>? cc,
    List<String>? bcc,
    Map<String, dynamic>? customArgs,
  }) async {
    try {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º SendGrid –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
      if (kDebugMode) {
        return await _smtpService.sendEmail(
          to: to,
          subject: subject,
          htmlContent: htmlContent,
          textContent: textContent,
          cc: cc,
          bcc: bcc,
        );
      } else {
        return await _sendGridService.sendEmail(
          to: to,
          subject: subject,
          htmlContent: htmlContent,
          textContent: textContent,
          cc: cc,
          bcc: bcc,
          customArgs: customArgs,
        );
      }
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email: $e');
      return false;
    }
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–π email
  Future<bool> sendTemplateEmail({
    required String to,
    required String templateId,
    required Map<String, dynamic> dynamicTemplateData,
    List<String>? cc,
    List<String>? bcc,
  }) async {
    try {
      return await _sendGridService.sendTemplateEmail(
        to: to,
        templateId: templateId,
        dynamicTemplateData: dynamicTemplateData,
        cc: cc,
        bcc: bcc,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ email: $e');
      return false;
    }
  }
}
```

### 3. üìß SMTP —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### 3.1 SMTP —Å–µ—Ä–≤–∏—Å
```dart
// lib/services/smtp_email_service.dart
import 'package:mailer/mailer.dart';
import 'package:mailer/smtp_server.dart';

class SMTPEmailService {
  static const String _smtpHost = 'smtp.gmail.com';
  static const int _smtpPort = 587;
  static const String _username = 'your-email@gmail.com';
  static const String _password = 'your-app-password';
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å email —á–µ—Ä–µ–∑ SMTP
  Future<bool> sendEmail({
    required String to,
    required String subject,
    required String htmlContent,
    String? textContent,
    List<String>? cc,
    List<String>? bcc,
  }) async {
    try {
      final smtpServer = SmtpServer(
        _smtpHost,
        port: _smtpPort,
        username: _username,
        password: _password,
        allowInsecure: false,
        ssl: false,
        ignoreBadCertificate: false,
      );
      
      final message = Message()
        ..from = Address(_username, 'Event Marketplace')
        ..recipients.add(to)
        ..subject = subject
        ..html = htmlContent;
      
      if (textContent != null) {
        message.text = textContent;
      }
      
      if (cc != null) {
        message.ccRecipients.addAll(cc);
      }
      
      if (bcc != null) {
        message.bccRecipients.addAll(bcc);
      }
      
      final sendReport = await send(message, smtpServer);
      return sendReport.sent;
    } catch (e) {
      print('–û—à–∏–±–∫–∞ SMTP: $e');
      return false;
    }
  }
}
```

## üìß Email —à–∞–±–ª–æ–Ω—ã

### 1. üé® HTML —à–∞–±–ª–æ–Ω—ã

#### 1.1 –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
```dart
// lib/templates/email_templates.dart
class EmailTemplates {
  static String get baseTemplate => '''
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Marketplace</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 10px 10px 0 0;
        }
        .content {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 0 0 10px 10px;
        }
        .button {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 5px;
            margin: 20px 0;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Event Marketplace</h1>
        <p>–í–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</p>
    </div>
    <div class="content">
        {{content}}
    </div>
    <div class="footer">
        <p>¬© 2025 Event Marketplace. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        <p>–ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ —ç—Ç–æ –ø–∏—Å—å–º–æ, –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –µ–≥–æ.</p>
    </div>
</body>
</html>
''';

  /// –®–∞–±–ª–æ–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
  static String get welcomeTemplate => baseTemplate.replaceAll(
    '{{content}}',
    '''
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Event Marketplace!</h2>
    <p>–ü—Ä–∏–≤–µ—Ç, {{userName}}!</p>
    <p>–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ Event Marketplace. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:</p>
    <ul>
        <li>–ù–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</li>
        <li>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥–∏ –æ–Ω–ª–∞–π–Ω</li>
        <li>–û–±—â–∞—Ç—å—Å—è —Å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏ –≤ —á–∞—Ç–µ</li>
        <li>–û—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤—ã –∏ –æ—Ü–µ–Ω–∫–∏</li>
    </ul>
    <a href="{{appUrl}}" class="button">–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫</a>
    <p>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –≤ –Ω–∞—à—É —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.</p>
    ''',
  );

  /// –®–∞–±–ª–æ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  static String get bookingConfirmationTemplate => baseTemplate.replaceAll(
    '{{content}}',
    '''
    <h2>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!</h2>
    <p>–ü—Ä–∏–≤–µ—Ç, {{userName}}!</p>
    <p>–í–∞—à–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:</p>
    <div style="background: white; padding: 20px; border-radius: 5px; margin: 20px 0;">
        <h3>–î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        <p><strong>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</strong> {{specialistName}}</p>
        <p><strong>–£—Å–ª—É–≥–∞:</strong> {{serviceName}}</p>
        <p><strong>–î–∞—Ç–∞:</strong> {{bookingDate}}</p>
        <p><strong>–í—Ä–µ–º—è:</strong> {{bookingTime}}</p>
        <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{totalPrice}} ‚ÇΩ</p>
        <p><strong>–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞:</strong> {{prepayment}} ‚ÇΩ</p>
    </div>
    <a href="{{bookingUrl}}" class="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
    <p>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –∏–ª–∏ —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.</p>
    ''',
  );

  /// –®–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
  static String get paymentNotificationTemplate => baseTemplate.replaceAll(
    '{{content}}',
    '''
    <h2>–ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!</h2>
    <p>–ü—Ä–∏–≤–µ—Ç, {{userName}}!</p>
    <p>–í–∞—à –ø–ª–∞—Ç–µ–∂ –≤ —Ä–∞–∑–º–µ—Ä–µ <strong>{{amount}} ‚ÇΩ</strong> –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω.</p>
    <div style="background: white; padding: 20px; border-radius: 5px; margin: 20px 0;">
        <h3>–î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞</h3>
        <p><strong>ID –ø–ª–∞—Ç–µ–∂–∞:</strong> {{paymentId}}</p>
        <p><strong>–°—É–º–º–∞:</strong> {{amount}} ‚ÇΩ</p>
        <p><strong>–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã:</strong> {{paymentMethod}}</p>
        <p><strong>–î–∞—Ç–∞:</strong> {{paymentDate}}</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{paymentStatus}}</p>
    </div>
    <a href="{{paymentUrl}}" class="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞—Ç–µ–∂</a>
    <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Event Marketplace!</p>
    ''',
  );

  /// –®–∞–±–ª–æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
  static String get eventReminderTemplate => baseTemplate.replaceAll(
    '{{content}}',
    '''
    <h2>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏</h2>
    <p>–ü—Ä–∏–≤–µ—Ç, {{userName}}!</p>
    <p>–ù–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –∑–∞–≤—Ç—Ä–∞ —É –≤–∞—Å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ:</p>
    <div style="background: white; padding: 20px; border-radius: 5px; margin: 20px 0;">
        <h3>–î–µ—Ç–∞–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
        <p><strong>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</strong> {{specialistName}}</p>
        <p><strong>–£—Å–ª—É–≥–∞:</strong> {{serviceName}}</p>
        <p><strong>–î–∞—Ç–∞:</strong> {{eventDate}}</p>
        <p><strong>–í—Ä–µ–º—è:</strong> {{eventTime}}</p>
        <p><strong>–ú–µ—Å—Ç–æ:</strong> {{eventLocation}}</p>
    </div>
    <a href="{{eventUrl}}" class="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏</a>
    <p>–£–¥–∞—á–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è!</p>
    ''',
  );

  /// –®–∞–±–ª–æ–Ω —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
  static String get passwordResetTemplate => baseTemplate.replaceAll(
    '{{content}}',
    '''
    <h2>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
    <p>–ü—Ä–∏–≤–µ—Ç, {{userName}}!</p>
    <p>–í—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ Event Marketplace.</p>
    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</p>
    <a href="{{resetUrl}}" class="button">–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</a>
    <p>–ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è, –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
    <p>–°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.</p>
    ''',
  );
}
```

### 2. üìù –°–µ—Ä–≤–∏—Å —à–∞–±–ª–æ–Ω–æ–≤

#### 2.1 –°–µ—Ä–≤–∏—Å —à–∞–±–ª–æ–Ω–æ–≤
```dart
// lib/services/email_template_service.dart
import '../templates/email_templates.dart';

class EmailTemplateService {
  /// –ó–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω–µ
  static String replaceVariables(String template, Map<String, dynamic> variables) {
    String result = template;
    
    variables.forEach((key, value) {
      result = result.replaceAll('{{$key}}', value.toString());
    });
    
    return result;
  }
  
  /// –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
  static String getWelcomeEmail({
    required String userName,
    required String appUrl,
  }) {
    return replaceVariables(
      EmailTemplates.welcomeTemplate,
      {
        'userName': userName,
        'appUrl': appUrl,
      },
    );
  }
  
  /// –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  static String getBookingConfirmationEmail({
    required String userName,
    required String specialistName,
    required String serviceName,
    required String bookingDate,
    required String bookingTime,
    required double totalPrice,
    required double prepayment,
    required String bookingUrl,
  }) {
    return replaceVariables(
      EmailTemplates.bookingConfirmationTemplate,
      {
        'userName': userName,
        'specialistName': specialistName,
        'serviceName': serviceName,
        'bookingDate': bookingDate,
        'bookingTime': bookingTime,
        'totalPrice': totalPrice.toStringAsFixed(0),
        'prepayment': prepayment.toStringAsFixed(0),
        'bookingUrl': bookingUrl,
      },
    );
  }
  
  /// –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
  static String getPaymentNotificationEmail({
    required String userName,
    required String paymentId,
    required double amount,
    required String paymentMethod,
    required String paymentDate,
    required String paymentStatus,
    required String paymentUrl,
  }) {
    return replaceVariables(
      EmailTemplates.paymentNotificationTemplate,
      {
        'userName': userName,
        'paymentId': paymentId,
        'amount': amount.toStringAsFixed(0),
        'paymentMethod': paymentMethod,
        'paymentDate': paymentDate,
        'paymentStatus': paymentStatus,
        'paymentUrl': paymentUrl,
      },
    );
  }
  
  /// –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
  static String getEventReminderEmail({
    required String userName,
    required String specialistName,
    required String serviceName,
    required String eventDate,
    required String eventTime,
    required String eventLocation,
    required String eventUrl,
  }) {
    return replaceVariables(
      EmailTemplates.eventReminderTemplate,
      {
        'userName': userName,
        'specialistName': specialistName,
        'serviceName': serviceName,
        'eventDate': eventDate,
        'eventTime': eventTime,
        'eventLocation': eventLocation,
        'eventUrl': eventUrl,
      },
    );
  }
  
  /// –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
  static String getPasswordResetEmail({
    required String userName,
    required String resetUrl,
  }) {
    return replaceVariables(
      EmailTemplates.passwordResetTemplate,
      {
        'userName': userName,
        'resetUrl': resetUrl,
      },
    );
  }
}
```

## üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 1. üìß –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 1.1 –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```dart
// lib/services/notification_service.dart
import 'email_service.dart';
import 'email_template_service.dart';
import 'fcm_service.dart';

class NotificationService {
  final EmailService _emailService = EmailService();
  final FCMService _fcmService = FCMService();
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  Future<bool> sendWelcomeNotification({
    required String userEmail,
    required String userName,
    required String appUrl,
  }) async {
    try {
      final htmlContent = EmailTemplateService.getWelcomeEmail(
        userName: userName,
        appUrl: appUrl,
      );
      
      return await _emailService.sendEmail(
        to: userEmail,
        subject: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Event Marketplace!',
        htmlContent: htmlContent,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: $e');
      return false;
    }
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  Future<bool> sendBookingConfirmationNotification({
    required String userEmail,
    required String userName,
    required String specialistName,
    required String serviceName,
    required String bookingDate,
    required String bookingTime,
    required double totalPrice,
    required double prepayment,
    required String bookingUrl,
  }) async {
    try {
      final htmlContent = EmailTemplateService.getBookingConfirmationEmail(
        userName: userName,
        specialistName: specialistName,
        serviceName: serviceName,
        bookingDate: bookingDate,
        bookingTime: bookingTime,
        totalPrice: totalPrice,
        prepayment: prepayment,
        bookingUrl: bookingUrl,
      );
      
      return await _emailService.sendEmail(
        to: userEmail,
        subject: '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ - $serviceName',
        htmlContent: htmlContent,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏: $e');
      return false;
    }
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–µ
  Future<bool> sendPaymentNotification({
    required String userEmail,
    required String userName,
    required String paymentId,
    required double amount,
    required String paymentMethod,
    required String paymentDate,
    required String paymentStatus,
    required String paymentUrl,
  }) async {
    try {
      final htmlContent = EmailTemplateService.getPaymentNotificationEmail(
        userName: userName,
        paymentId: paymentId,
        amount: amount,
        paymentMethod: paymentMethod,
        paymentDate: paymentDate,
        paymentStatus: paymentStatus,
        paymentUrl: paymentUrl,
      );
      
      return await _emailService.sendEmail(
        to: userEmail,
        subject: '–ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–æ—Ç–∞–Ω - $amount ‚ÇΩ',
        htmlContent: htmlContent,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ: $e');
      return false;
    }
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
  Future<bool> sendEventReminderNotification({
    required String userEmail,
    required String userName,
    required String specialistName,
    required String serviceName,
    required String eventDate,
    required String eventTime,
    required String eventLocation,
    required String eventUrl,
  }) async {
    try {
      final htmlContent = EmailTemplateService.getEventReminderEmail(
        userName: userName,
        specialistName: specialistName,
        serviceName: serviceName,
        eventDate: eventDate,
        eventTime: eventTime,
        eventLocation: eventLocation,
        eventUrl: eventUrl,
      );
      
      return await _emailService.sendEmail(
        to: userEmail,
        subject: '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –∑–∞–≤—Ç—Ä–∞',
        htmlContent: htmlContent,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏: $e');
      return false;
    }
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è
  Future<bool> sendPasswordResetNotification({
    required String userEmail,
    required String userName,
    required String resetUrl,
  }) async {
    try {
      final htmlContent = EmailTemplateService.getPasswordResetEmail(
        userName: userName,
        resetUrl: resetUrl,
      );
      
      return await _emailService.sendEmail(
        to: userEmail,
        subject: '–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è - Event Marketplace',
        htmlContent: htmlContent,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è: $e');
      return false;
    }
  }
  
  /// –û—Ç–ø—Ä–∞–≤–∏—Ç—å push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  Future<bool> sendPushNotification({
    required String userId,
    required String title,
    required String body,
    Map<String, dynamic>? data,
  }) async {
    try {
      return await _fcmService.sendNotification(
        userId: userId,
        title: title,
        body: body,
        data: data,
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: $e');
      return false;
    }
  }
}
```

### 2. ‚è∞ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 2.1 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
```dart
// lib/services/notification_scheduler_service.dart
import 'package:cloud_functions/cloud_functions.dart';
import 'notification_service.dart';

class NotificationSchedulerService {
  final NotificationService _notificationService = NotificationService();
  final FirebaseFunctions _functions = FirebaseFunctions.instance;
  
  /// –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
  Future<bool> scheduleEventReminder({
    required String userEmail,
    required String userName,
    required String specialistName,
    required String serviceName,
    required DateTime eventDate,
    required String eventLocation,
    required String eventUrl,
  }) async {
    try {
      // –í—ã—á–∏—Å–ª—è–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–∑–∞ 24 —á–∞—Å–∞ –¥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)
      final reminderTime = eventDate.subtract(const Duration(hours: 24));
      
      // –í—ã–∑—ã–≤–∞–µ–º Cloud Function –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      final result = await _functions.httpsCallable('scheduleNotification').call({
        'type': 'event_reminder',
        'scheduledTime': reminderTime.toIso8601String(),
        'data': {
          'userEmail': userEmail,
          'userName': userName,
          'specialistName': specialistName,
          'serviceName': serviceName,
          'eventDate': eventDate.toIso8601String(),
          'eventLocation': eventLocation,
          'eventUrl': eventUrl,
        },
      });
      
      return result.data['success'] == true;
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: $e');
      return false;
    }
  }
  
  /// –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  Future<bool> cancelScheduledNotification(String notificationId) async {
    try {
      final result = await _functions.httpsCallable('cancelNotification').call({
        'notificationId': notificationId,
      });
      
      return result.data['success'] == true;
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: $e');
      return false;
    }
  }
}
```

## ‚òÅÔ∏è Cloud Functions –¥–ª—è email

### 1. üîß –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 1.1 –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
```javascript
// functions/send-email.js
const functions = require('firebase-functions');
const admin = require('firebase-admin');
const sgMail = require('@sendgrid/mail');

sgMail.setApiKey(functions.config().sendgrid.api_key);

exports.sendEmail = functions.https.onCall(async (data, context) => {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω');
  }
  
  const { to, subject, htmlContent, textContent, customArgs } = data;
  
  try {
    const msg = {
      to: to,
      from: {
        email: functions.config().email.from_email,
        name: functions.config().email.from_name,
      },
      subject: subject,
      html: htmlContent,
      text: textContent,
      customArgs: customArgs,
    };
    
    await sgMail.send(msg);
    
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    await admin.firestore().collection('email_logs').add({
      to: to,
      subject: subject,
      sentAt: admin.firestore.FieldValue.serverTimestamp(),
      userId: context.auth.uid,
    });
    
    return { success: true };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email:', error);
    throw new functions.https.HttpsError('internal', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email');
  }
});
```

#### 1.2 –§—É–Ω–∫—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```javascript
// functions/schedule-notification.js
const functions = require('firebase-functions');
const admin = require('firebase-admin');

exports.scheduleNotification = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω');
  }
  
  const { type, scheduledTime, data: notificationData } = data;
  
  try {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ Firestore
    const taskRef = await admin.firestore().collection('scheduled_notifications').add({
      type: type,
      scheduledTime: admin.firestore.Timestamp.fromDate(new Date(scheduledTime)),
      data: notificationData,
      status: 'scheduled',
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      userId: context.auth.uid,
    });
    
    return { success: true, taskId: taskRef.id };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
    throw new functions.https.HttpsError('internal', '–û—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
  }
});
```

#### 1.3 –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```javascript
// functions/process-scheduled-notifications.js
const functions = require('firebase-functions');
const admin = require('firebase-admin');
const sgMail = require('@sendgrid/mail');

sgMail.setApiKey(functions.config().sendgrid.api_key);

exports.processScheduledNotifications = functions.pubsub
  .schedule('every 5 minutes')
  .onRun(async (context) => {
    const now = admin.firestore.Timestamp.now();
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    const tasksSnapshot = await admin.firestore()
      .collection('scheduled_notifications')
      .where('scheduledTime', '<=', now)
      .where('status', '==', 'scheduled')
      .limit(100)
      .get();
    
    const promises = tasksSnapshot.docs.map(async (doc) => {
      const task = doc.data();
      
      try {
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è"
        await doc.ref.update({
          status: 'processing',
          processedAt: admin.firestore.FieldValue.serverTimestamp(),
        });
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        switch (task.type) {
          case 'event_reminder':
            await sendEventReminderEmail(task.data);
            break;
          case 'payment_reminder':
            await sendPaymentReminderEmail(task.data);
            break;
          default:
            console.log(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${task.type}`);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "–∑–∞–≤–µ—Ä—à–µ–Ω–æ"
        await doc.ref.update({
          status: 'completed',
          completedAt: admin.firestore.FieldValue.serverTimestamp(),
        });
        
      } catch (error) {
        console.error(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ ${doc.id}:`, error);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "–æ—à–∏–±–∫–∞"
        await doc.ref.update({
          status: 'failed',
          error: error.message,
          failedAt: admin.firestore.FieldValue.serverTimestamp(),
        });
      }
    });
    
    await Promise.all(promises);
  });

async function sendEventReminderEmail(data) {
  const msg = {
    to: data.userEmail,
    from: {
      email: functions.config().email.from_email,
      name: functions.config().email.from_name,
    },
    subject: '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –∑–∞–≤—Ç—Ä–∞',
    html: generateEventReminderHTML(data),
  };
  
  await sgMail.send(msg);
}

async function sendPaymentReminderEmail(data) {
  const msg = {
    to: data.userEmail,
    from: {
      email: functions.config().email.from_email,
      name: functions.config().email.from_name,
    },
    subject: '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ',
    html: generatePaymentReminderHTML(data),
  };
  
  await sgMail.send(msg);
}
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ email

### 1. üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ email

#### 1.1 –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```dart
// lib/services/email_analytics_service.dart
import 'package:firebase_analytics/firebase_analytics.dart';

class EmailAnalyticsService {
  static final FirebaseAnalytics _analytics = FirebaseAnalytics.instance;
  
  /// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ email
  static Future<void> trackEmailSent({
    required String emailType,
    required String recipientEmail,
    required bool success,
    String? errorMessage,
  }) async {
    await _analytics.logEvent(
      name: 'email_sent',
      parameters: {
        'email_type': emailType,
        'recipient_email': recipientEmail,
        'success': success,
        if (errorMessage != null) 'error_message': errorMessage,
      },
    );
  }
  
  /// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è email
  static Future<void> trackEmailOpened({
    required String emailType,
    required String recipientEmail,
  }) async {
    await _analytics.logEvent(
      name: 'email_opened',
      parameters: {
        'email_type': emailType,
        'recipient_email': recipientEmail,
      },
    );
  }
  
  /// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –≤ email
  static Future<void> trackEmailLinkClicked({
    required String emailType,
    required String recipientEmail,
    required String linkUrl,
  }) async {
    await _analytics.logEvent(
      name: 'email_link_clicked',
      parameters: {
        'email_type': emailType,
        'recipient_email': recipientEmail,
        'link_url': linkUrl,
      },
    );
  }
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. üõ°Ô∏è –ó–∞—â–∏—Ç–∞ email

#### 1.1 –í–∞–ª–∏–¥–∞—Ü–∏—è email
```dart
// lib/services/email_validation_service.dart
class EmailValidationService {
  /// –í–∞–ª–∏–¥–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–∞
  static bool isValidEmail(String email) {
    final regex = RegExp(r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$');
    return regex.hasMatch(email);
  }
  
  /// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞ email
  static bool isAllowedDomain(String email) {
    final allowedDomains = [
      'gmail.com',
      'yahoo.com',
      'outlook.com',
      'mail.ru',
      'yandex.ru',
      'rambler.ru',
    ];
    
    final domain = email.split('@').last.toLowerCase();
    return allowedDomains.contains(domain);
  }
  
  /// –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è email
  static String sanitizeEmail(String email) {
    return email.toLowerCase().trim();
  }
}
```

#### 1.2 –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
```dart
// lib/services/email_spam_protection_service.dart
class EmailSpamProtectionService {
  static final Map<String, int> _emailCounts = {};
  static final Map<String, DateTime> _lastSent = {};
  
  /// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏
  static bool canSendEmail(String email, {int maxPerHour = 10}) {
    final now = DateTime.now();
    final hourAgo = now.subtract(const Duration(hours: 1));
    
    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
    _emailCounts.removeWhere((key, value) => 
      _lastSent[key]?.isBefore(hourAgo) ?? true);
    
    final count = _emailCounts[email] ?? 0;
    final lastSent = _lastSent[email];
    
    if (lastSent != null && now.difference(lastSent).inMinutes < 1) {
      return false; // –ù–µ –±–æ–ª–µ–µ 1 –ø–∏—Å—å–º–∞ –≤ –º–∏–Ω—É—Ç—É
    }
    
    if (count >= maxPerHour) {
      return false; // –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –≤ —á–∞—Å
    }
    
    return true;
  }
  
  /// –ó–∞–ø–∏—Å—å –æ—Ç–ø—Ä–∞–≤–∫–∏ email
  static void recordEmailSent(String email) {
    final now = DateTime.now();
    _emailCounts[email] = (_emailCounts[email] ?? 0) + 1;
    _lastSent[email] = now;
  }
}
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. ‚úÖ –ì–æ—Ç–æ–≤–æ
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SendGrid
- ‚úÖ SMTP —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ HTML —à–∞–±–ª–æ–Ω—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ Cloud Functions
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ email
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 2. üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ email –æ—Ç–ø—Ä–∞–≤–∫–∏
- üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞
- üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏

### 3. üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
- üìã A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
- üìã –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è email
- üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
- üìã –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Email —Å–µ—Ä–≤–∏—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å:
- ‚úÖ **SendGrid** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ **SMTP** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **HTML —à–∞–±–ª–æ–Ω–∞–º–∏** –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **Cloud Functions** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–æ–π** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é** –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç —Å–ø–∞–º–∞

**–ì–æ—Ç–æ–≤–æ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!** üöÄ

---
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
