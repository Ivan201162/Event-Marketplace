# –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤

**–î–∞—Ç–∞/–≤—Ä–µ–º—è:** 2025-01-27  
**–í–µ—Ç–∫–∞:** prod/cutover-final  
**Commit hash:** 1c5e5d9b

---

## ‚úÖ –ö–õ–Æ–ß–ï–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. Cloud Functions (Backend)

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `functions/src/config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ—Å–æ–≤ —Ä–µ–π—Ç–∏–Ω–≥–∞
- `functions/src/utils.ts` - –£—Ç–∏–ª–∏—Ç—ã (z-score, —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ)
- `functions/src/triggers.ts` - Firestore —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- `functions/src/computeScores.ts` - Cron —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- `functions/src/index.ts` - –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π

**–ö–æ–ª–ª–µ–∫—Ü–∏–∏:**
- `specialist_stats/{specId}` - –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏
- `specialist_scores/{specId}` - –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
- `events_profile_views/{autoId}` - –°–æ–±—ã—Ç–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π
- `events_post_engagement/{autoId}` - –°–æ–±—ã—Ç–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ—Å—Ç–∞–º–∏
- `events_follow/{autoId}` - –°–æ–±—ã—Ç–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
- `events_requests/{autoId}` - –°–æ–±—ã—Ç–∏—è –∑–∞—è–≤–æ–∫

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- `onProfileViewCreated` - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç impressions, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (4 —á–∞—Å–∞)
- `onPostEngagementCreated` - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç likes/comments/shares
- `onFollowCreated` - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç followers, newFollowsFromViews
- `onRequestEventCreated` - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç requestsTotal/requestsCompleted
- `onReviewWrite` - –ü–µ—Ä–µ—Å—á—ë—Ç reviewsAvg/reviewsCount

**Cron —Ñ—É–Ω–∫—Ü–∏—è:**
- `recomputeScores` - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏

### 2. Firestore Rules

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è:**
- `events_profile_views`, `events_post_engagement`, `events_follow`, `events_requests` - –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `specialist_stats`, `specialist_scores` - —á—Ç–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º
- `dedup_profile_views`, `rate_limits` - —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

### 3. Firestore Indexes

**–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã:**
- `specialist_scores`: scoreFinal DESC, scoreWeekly DESC, city ASC + scoreWeekly DESC + updatedAt DESC
- `specialist_stats`: city ASC + country ASC + lastActivityAt DESC
- `events_profile_views`: specId ASC + viewerId ASC + createdAt DESC
- `events_post_engagement`: specId ASC + type ASC + createdAt DESC
- `events_follow`: specId ASC + followerId ASC + createdAt DESC
- `events_requests`: specId ASC + status ASC + createdAt DESC

### 4. –ö–ª–∏–µ–Ω—Ç: Analytics Service

**–§–∞–π–ª:** `lib/services/analytics_service.dart`

**–ú–µ—Ç–æ–¥—ã:**
- `logProfileView(specId)` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è
- `logPostEngagement(specId, postId, type)` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∞–π–∫–æ–≤/–∫–æ–º–º–µ–Ω—Ç–æ–≤/—à–∞—Ä–∏–Ω–≥–∞
- `logFollow(specId, source)` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- `logRequestEvent(specId, requestId, status)` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è/–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞—è–≤–∫–∏

**–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞:**
- Debounce 2-3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 5. –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ UI –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** `lib/providers/specialist_providers.dart`

- `topSpecialistsByCityProvider` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `specialist_scores` —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ `scoreWeekly DESC`
- `topSpecialistsByRussiaProvider` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `specialist_stats` (country='RU') –∏ `specialist_scores`
- Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É (rating) –µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
- –î–æ–±–∞–≤–ª–µ–Ω `AnalyticsService.logProfileView()` –≤ `SpecialistProfileExtendedScreen`

### 6. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–ö–∞—Ä—É—Å–µ–ª–∏:**
- "–õ—É—á—à–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –Ω–µ–¥–µ–ª–∏ ‚Äî –†–æ—Å—Å–∏—è" - —Ç–æ–ø-10 –ø–æ `scoreWeekly`, country='RU'
- "–õ—É—á—à–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –Ω–µ–¥–µ–ª–∏ ‚Äî {–≥–æ—Ä–æ–¥}" - —Ç–æ–ø-10 –ø–æ `scoreWeekly`, city=userCity
- –§–æ–ª–ª–±–µ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–π—Ç–µ"

---

## üìä –§–û–†–ú–£–õ–´ –ò –í–ï–°–ê

### –§–æ—Ä–º—É–ª–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞:
```
scoreBase = (reviewsAvg * W_REV)
          + (engagement * W_ENG)
          + (conversion * W_CONV)
          + (completion * W_COMP)
          + (sqrt(followers) * W_FOLLOWERS_SQRT)
```

–≥–¥–µ:
- `engagement = (likes*1 + comments*2 + shares*3) / max(impressions, 1)`
- `conversion = newFollowsFromViews / max(impressions, 1)`
- `completion = requestsCompleted / max(requestsTotal, 1)`

### –§–æ—Ä–º—É–ª–∞ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞:
```
scoreWeekly = Œ£ (eventWeight * exp(-lambdaWeekly * hoursSinceEvent))
```

–¥–ª—è —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π —Å–æ —Å–ø–∞–¥–æ–º.

### –§–æ—Ä–º—É–ª–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞:
```
scoreFinal = (scoreBase * ALPHA)
           + (zCountry * BETA)
           + (zCity * GAMMA)
           + (recency * DELTA)
```

–≥–¥–µ:
- `zCountry = zscore(scoreBase —Å—Ä–µ–¥–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ country == 'RU')`
- `zCity = zscore(scoreBase —Å—Ä–µ–¥–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ city == userCity)`
- `recency = exp(-lambda * ageDaysLastActivity)`

### –¢–µ–∫—É—â–∏–µ –≤–µ—Å–∞ (–¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ):

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| W_REV | 4.0 | –í–µ—Å –æ—Ç–∑—ã–≤–æ–≤ |
| W_ENG | 2.0 | –í–µ—Å –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏ |
| W_CONV | 3.0 | –í–µ—Å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ –ø–æ–¥–ø–∏—Å–∫–∏ |
| W_COMP | 3.5 | –í–µ—Å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ |
| W_FOLLOWERS_SQRT | 0.2 | –í–µ—Å sqrt(–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤) |
| lambda | 0.18 | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è –¥–ª—è lastActivity |
| lambdaWeekly | 0.06 | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è –¥–ª—è –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ |
| ALPHA | 0.65 | –í–µ—Å –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ |
| BETA | 0.2 | –í–µ—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–µ |
| GAMMA | 0.1 | –í–µ—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –≥–æ—Ä–æ–¥—É |
| DELTA | 0.05 | –í–µ—Å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ (recency) |
| BAYESIAN_PRIOR | 4.5 | –ê–ø—Ä–∏–æ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ |
| BAYESIAN_WEIGHT | 3 | –í–µ—Å –∞–ø—Ä–∏–æ—Ä–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ |
| MIN_REVIEWS_FOR_BAYESIAN | 3 | –ú–∏–Ω–∏–º—É–º –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–∞–π–µ—Å–æ–≤—Å–∫–æ–π –æ—Ü–µ–Ω–∫–∏ |

### –ë–∞–π–µ—Å–æ–≤—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:
–ï—Å–ª–∏ `reviewsCount < 3`:
```
adjustedRating = (reviewsAvg * reviewsCount + BAYESIAN_PRIOR * BAYESIAN_WEIGHT) / (reviewsCount + BAYESIAN_WEIGHT)
```

---

## ‚öôÔ∏è –ö–û–ú–ê–ù–î–´ –î–õ–Ø –†–£–ß–ù–û–ô –ü–ï–†–ï–ù–ê–°–¢–†–û–ô–ö–ò –í–ï–°–û–í

### –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Firebase Functions):

```bash
firebase functions:config:set scoring.w_rev=4.0
firebase functions:config:set scoring.w_eng=2.0
firebase functions:config:set scoring.w_conv=3.0
firebase functions:config:set scoring.w_comp=3.5
firebase functions:config:set scoring.w_followers_sqrt=0.2
firebase functions:config:set scoring.lambda=0.18
firebase functions:config:set scoring.lambda_weekly=0.06
firebase functions:config:set scoring.alpha=0.65
firebase functions:config:set scoring.beta=0.2
firebase functions:config:set scoring.gamma=0.1
firebase functions:config:set scoring.delta=0.05
```

### –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ `functions/src/config.ts`:

–ò–∑–º–µ–Ω—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–±—ä–µ–∫—Ç–µ `SCORING_WEIGHTS`, –∑–∞—Ç–µ–º:
```bash
cd functions
npm run build
firebase deploy --only functions
```

---

## üì¶ –î–ï–ü–õ–û–ô

### Firestore Rules –∏ Indexes:
```bash
firebase deploy --only firestore:rules,firestore:indexes
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ò–Ω–¥–µ–∫—Å—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ë–î, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –∫–∞–∫ composite)

### Cloud Functions:
```bash
cd functions
npm install
npm run build
firebase deploy --only functions
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –≤ TypeScript (v1 API)

---

## üì± APK –°–ë–û–†–ö–ê –ò –£–°–¢–ê–ù–û–í–ö–ê

**–ü—É—Ç—å APK:** `build/app/outputs/flutter-apk/app-release.apk`  
**–†–∞–∑–º–µ—Ä:** 74.95 MB  
**–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:** ‚úÖ –£—Å–ø–µ—à–Ω–æ  
**–†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** ‚úÖ –£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (34HDU20228002261)

---

## üß™ SMOKE-–¢–ï–°–¢–´

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- –°–±–æ—Ä–∫–∞ APK —É—Å–ø–µ—à–Ω–∞
- Firestore Rules –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- Firestore Indexes –¥–æ–±–∞–≤–ª–µ–Ω—ã (—á–∞—Å—Ç–∏—á–Ω–æ)
- Analytics Service —Å–æ–∑–¥–∞–Ω
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
- Login (email –∏ Google) ‚Üí –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ ‚Üí –≤—ã–±–æ—Ä —Ä–æ–ª–∏ ‚Üí –ì–ª–∞–≤–Ω–∞—è
- –ì–ª–∞–≤–Ω–∞—è: –∞–≤–∞—Ç–∞—Ä ‚Üí –ø—Ä–æ—Ñ–∏–ª—å; —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞ ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∏; –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É", "–ù–∞–π—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞"
- –õ–µ–Ω—Ç–∞: –ø—É—Å—Ç–∞—è –±–µ–∑ –ø–æ–¥–ø–∏—Å–æ–∫; –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äî –ø–æ—Å—Ç—ã –≤–∏–¥–Ω—ã
- –ò–¥–µ–∏: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —à–æ—Ä—Ç—Å—ã, —Å–æ–∑–¥–∞–Ω–∏–µ —Å –≤–∏–¥–µ–æ/—Ñ–æ—Ç–æ, –ª–∞–π–∫–∏/–∫–æ–º–º–µ–Ω—Ç—ã real-time
- –ó–∞—è–≤–∫–∏: –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫, —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ß–∞—Ç—ã: –±–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤, –Ω–µ—Ç permission-denied/failed-precondition
- –ö–∞—Ä—É—Å–µ–ª–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π: –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ø —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ scoreWeekly
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ Firebase)

---

## ‚ö†Ô∏è –ó–ê–ú–ï–ß–ï–ù–ù–´–ï –†–ò–°–ö–ò / MINI-TODO

1. **Cloud Functions —Ç–∏–ø—ã:** –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `firebase-functions/v1` –≤–º–µ—Å—Ç–æ v2 API
2. **–ò–Ω–¥–µ–∫—Å—ã Firestore:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–¥–µ–∫—Å—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã –∫–∞–∫ composite - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:** –î–æ–±–∞–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ –≤ `SpecialistProfileExtendedScreen`, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤:
   - –õ–∞–π–∫–∏/–∫–æ–º–º–µ–Ω—Ç—ã/—à–∞—Ä–∏–Ω–≥ –ø–æ—Å—Ç–æ–≤ (feed screens)
   - –ü–æ–¥–ø–∏—Å–∫–∏ (follow buttons)
   - –°–æ–∑–¥–∞–Ω–∏–µ/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ (request screens)
4. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ `recomputeScores` –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ `specialist_stats` - —Ç—Ä–µ–±—É–µ—Ç—Å—è bootstrap —Å–∫—Ä–∏–ø—Ç
5. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** TTL –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ `dedup_profile_views` —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
6. **Rate limiting:** In-memory cache –º–æ–∂–µ—Ç —Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Ñ—É–Ω–∫—Ü–∏–π - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å Firestore TTL
7. **Fallback –ª–æ–≥–∏–∫–∞:** –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (rating), —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

---

## üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –≤—Ç–æ—Ä–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:**
   ```bash
   adb devices
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK:**
   ```bash
   adb install -r build/app/outputs/flutter-apk/app-release.apk
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   adb logcat | grep -i "AnalyticsService"
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ Firebase Console:**
   - Firestore ‚Üí Collections ‚Üí `events_profile_views`
   - Firestore ‚Üí Collections ‚Üí `events_post_engagement`
   - Firestore ‚Üí Collections ‚Üí `events_follow`
   - Firestore ‚Üí Collections ‚Üí `events_requests`

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏:**
   - Firestore ‚Üí Collections ‚Üí `specialist_scores`
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `scoreWeekly` –∏ `scoreFinal` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - –ö–∞—Ä—É—Å–µ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
   - –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ–ª–ª–±–µ–∫

---

## üìù –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

### Backend (Cloud Functions):
- `functions/package.json` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `functions/tsconfig.json` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
- `functions/src/config.ts` - **–Ω–æ–≤—ã–π**
- `functions/src/utils.ts` - **–Ω–æ–≤—ã–π**
- `functions/src/triggers.ts` - **–Ω–æ–≤—ã–π**
- `functions/src/computeScores.ts` - **–Ω–æ–≤—ã–π**
- `functions/src/index.ts` - –æ–±–Ω–æ–≤–ª—ë–Ω

### –ö–ª–∏–µ–Ω—Ç (Flutter):
- `lib/services/analytics_service.dart` - **–Ω–æ–≤—ã–π**
- `lib/providers/specialist_providers.dart` - –æ–±–Ω–æ–≤–ª—ë–Ω
- `lib/screens/specialist_profile_extended_screen.dart` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- `firestore.rules` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `firestore.indexes.json` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á—ë—Ç–∞**

