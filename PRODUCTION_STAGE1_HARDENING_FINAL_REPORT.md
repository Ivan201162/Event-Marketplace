# –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢: Production Stage 1 Hardening

**–î–∞—Ç–∞/–≤—Ä–µ–º—è:** 2025-01-27  
**–í–µ—Ç–∫–∞:** `prod/stage1-hardening`  
**–ü–æ—Å–ª–µ–¥–Ω–∏–π commit:** `d73d4a99`

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–µ—Ç–∫–∏ –∏ —Ñ–ª–∞–≥–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≤–µ—Ç–∫–∞ `prod/stage1-hardening`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω `pubspec.yaml` –∏ `app_config.dart`:
  - `kProduction = true`
  - `kUseDemoData = false`
  - `kAutoSeedOnStart = false`
  - `kShowFeedFab = false`
  - `kEnableFollowingFeed = true`

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–¥–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `lib/providers/ideas_provider.dart`
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `lib/providers/chats_provider.dart`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `lib/screens/requests/requests_screen_improved.dart` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `requestsProvider` –≤–º–µ—Å—Ç–æ mock –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`home_screen_simple.dart`)

### 3. Auth Flow
- ‚úÖ –≠–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω (`initialLocation: '/login'` –≤ `app_router_minimal_working.dart`)
- ‚úÖ –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ (`/role-selection`)

### 4. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ‚úÖ –ü–ª–∞—à–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–≤–∞—Ç–∞—Ä–æ–º, –∏–º–µ–Ω–µ–º, @username
- ‚úÖ –ò–∫–æ–Ω–∫–∞ ‚öôÔ∏è –≤–µ–¥—ë—Ç –Ω–∞ `/settings`
- ‚úÖ –ö–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É" –∏ "–ù–∞–π—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞" —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã "–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è", "–ß–∞—Ç—ã", "–ò–¥–µ–∏" –∏–∑ –≥–ª–∞–≤–Ω–æ–π
- ‚úÖ –ö–∞—Ä—É—Å–µ–ª–∏ "–õ—É—á—à–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –Ω–µ–¥–µ–ª–∏" –∏—Å–ø–æ–ª—å–∑—É—é—Ç `topSpecialistsByRussiaProvider` –∏ `topSpecialistsByCityProvider` (—Å fallback –Ω–∞ `rating`)

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–¥–µ–ª "–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è" —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ `/monetization`
- ‚úÖ –ò–∫–æ–Ω–∫–∞ ‚öôÔ∏è —Å –≥–ª–∞–≤–Ω–æ–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫

### 6. –õ–µ–Ω—Ç–∞, –∏–¥–µ–∏, –∑–∞—è–≤–∫–∏, —á–∞—Ç—ã
- ‚úÖ **–õ–µ–Ω—Ç–∞:** `getFollowingFeed()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç chunking –¥–ª—è `whereIn`, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º
- ‚úÖ **–ò–¥–µ–∏:** –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Firestore (–±–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö)
- ‚úÖ **–ó–∞—è–≤–∫–∏:** –≠–∫—Ä–∞–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `requestsProvider` –≤–º–µ—Å—Ç–æ mock –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ß–∞—Ç—ã:** –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã –∏–∑ Firestore (`participants contains uid`)

### 7. –ü—Ä–∞–≤–∏–ª–∞ –∏ –∏–Ω–¥–µ–∫—Å—ã Firestore
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã (`firestore.rules`)
- ‚ö†Ô∏è –ò–Ω–¥–µ–∫—Å—ã: –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –±—ã–ª–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ single-field –∏–Ω–¥–µ–∫—Å–∞—Ö –¥–ª—è `specialist_scores` (–æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### 8. APK —Å–±–æ—Ä–∫–∞
- ‚è≥ –°–±–æ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ
- ‚ö†Ô∏è APK –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤ (—Å–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)

---

## üìù –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

1. `lib/core/app_router_minimal_working.dart` - `initialLocation` –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ `/login`
2. `lib/providers/ideas_provider.dart` - —É–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
3. `lib/providers/chats_provider.dart` - —É–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ Firestore
4. `lib/screens/requests/requests_screen_improved.dart` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `requestsProvider` –≤–º–µ—Å—Ç–æ mock
5. `lib/screens/home/home_screen_simple.dart` - —É–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
6. `lib/screens/settings/settings_screen.dart` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—é
7. `firestore.indexes.json` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è `specialist_scores`

---

## üóëÔ∏è –£–î–ê–õ–Å–ù–ù–´–ï –¢–ï–°–¢–û–í–´–ï –î–ê–ù–ù–´–ï

### –ò–∑ –∫–æ–¥–∞:
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `ideas_provider.dart`
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `chats_provider.dart`
- ‚úÖ Mock –¥–∞–Ω–Ω—ã–µ –∏–∑ `requests_screen_improved.dart`
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (Firestore/Storage):
- ‚ö†Ô∏è –ö–æ–ª–ª–µ–∫—Ü–∏–∏ Firestore: `users`, `user_profiles`, `specialists`, `posts`, `ideas`, `stories`, `requests`, `chats`, `messages`, `follows`, `notifications`
- ‚ö†Ô∏è Storage –ø—Ä–µ—Ñ–∏–∫—Å—ã: `uploads/avatars/*`, `uploads/posts/*`, `uploads/reels/*`, `uploads/ideas/*`, `uploads/stories/*`
- ‚ö†Ô∏è –°–∫—Ä–∏–ø—Ç `tools/wipe_production.ts` —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω

---

## üîê –ü–†–ê–í–ò–õ–ê –ò –ò–ù–î–ï–ö–°–´ FIRESTORE

### –ü—Ä–∞–≤–∏–ª–∞ (`firestore.rules`):
- ‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è `events_*` –∫–æ–ª–ª–µ–∫—Ü–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è `specialist_stats` –∏ `specialist_scores` (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è `chats` –∏ `messages` (—Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏)

### –ò–Ω–¥–µ–∫—Å—ã (`firestore.indexes.json`):
- ‚ö†Ô∏è –î–µ–ø–ª–æ–π —á–∞—Å—Ç–∏—á–Ω–æ —É—Å–ø–µ—à–µ–Ω (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ single-field –∏–Ω–¥–µ–∫—Å–∞—Ö –¥–ª—è `specialist_scores`)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è `events_*` –∫–æ–ª–ª–µ–∫—Ü–∏–π
- ‚úÖ –ò–Ω–¥–µ–∫—Å –¥–ª—è `chats` (`participants ARRAY + updatedAt DESC`)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è `posts`, `ideas`, `requests`, `follows`

---

## üì± APK

**–ü—É—Ç—å:** `build/app/outputs/flutter-apk/app-release.apk`  
**–°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏:** ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ  
**–°—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** ‚è∏Ô∏è –û–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏

---

## üß™ SMOKE-–¢–ï–°–¢–´

–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ APK:

1. **Auth:** ‚úÖ –õ–æ–≥–∏–Ω –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –≤—ã–±–æ—Ä —Ä–æ–ª–∏ ‚Üí –≥–ª–∞–≤–Ω–∞—è
2. **–ì–ª–∞–≤–Ω–∞—è:** ‚ö†Ô∏è –ê–≤–∞—Ç–∞—Ä ‚Üí –ø—Ä–æ—Ñ–∏–ª—å, ‚öôÔ∏è ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
3. **–õ–µ–Ω—Ç–∞:** ‚ö†Ô∏è –ü—É—Å—Ç–∞—è –±–µ–∑ –ø–æ–¥–ø–∏—Å–æ–∫, –ø–æ—Å—Ç—ã –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏
4. **–ò–¥–µ–∏:** ‚ö†Ô∏è –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞, —Å–æ–∑–¥–∞–Ω–∏–µ, –ª–∞–π–∫–∏/–∫–æ–º–º–µ–Ω—Ç—ã
5. **–ó–∞—è–≤–∫–∏:** ‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫, —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
6. **–ß–∞—Ç—ã:** ‚ö†Ô∏è –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏, –Ω–µ—Ç –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞

---

## ‚ö†Ô∏è –†–ò–°–ö–ò / TODO

1. **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:** –°–∫—Ä–∏–ø—Ç `tools/wipe_production.ts` —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏–ª–∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞.
2. **APK:** –°–±–æ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
3. **–ò–Ω–¥–µ–∫—Å—ã:** –ü—Ä–∏ –¥–µ–ø–ª–æ–µ –±—ã–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Firebase Console.
4. **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:** –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `booking_requests_screen.dart` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ bookings).

---

## üìã –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –ù–ê –í–¢–û–†–û–ú –£–°–¢–†–û–ô–°–¢–í–ï

1. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏ APK
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `adb devices` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å `adb install -r build/app/outputs/flutter-apk/app-release.apk`
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å smoke-—Ç–µ—Å—Ç—ã

---

## üéØ –°–¢–ê–¢–£–° –ó–ê–î–ê–ß

- ‚úÖ –í–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- ‚úÖ Auth flow –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–µ–π –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –õ–µ–Ω—Ç–∞, –∏–¥–µ–∏, –∑–∞—è–≤–∫–∏, —á–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚ö†Ô∏è –û—á–∏—Å—Ç–∫–∞ Firestore/Storage –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (—Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω)
- ‚ö†Ô∏è APK —Å–±–æ—Ä–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚ö†Ô∏è Smoke-—Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏ APK
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å smoke-—Ç–µ—Å—Ç—ã
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞–ø—É—Å—Ç–∏—Ç—å `tools/wipe_production.ts` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã —á–µ—Ä–µ–∑ Firebase Console

